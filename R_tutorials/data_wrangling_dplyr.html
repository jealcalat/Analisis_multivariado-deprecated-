<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>data_wrangling_dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="data_wrangling_dplyr_files/libs/clipboard/clipboard.min.js"></script>
<script src="data_wrangling_dplyr_files/libs/quarto-html/quarto.js"></script>
<script src="data_wrangling_dplyr_files/libs/quarto-html/popper.min.js"></script>
<script src="data_wrangling_dplyr_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="data_wrangling_dplyr_files/libs/quarto-html/anchor.min.js"></script>
<link href="data_wrangling_dplyr_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="data_wrangling_dplyr_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="data_wrangling_dplyr_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="data_wrangling_dplyr_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="data_wrangling_dplyr_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="data-wrangling-con-dplyr-y-tidyr" class="level1">
<h1>Data wrangling con <code>{dplyr}</code> y <code>{tidyr}</code></h1>
<div class="alert alert-block alert-info">
<b>NOTA:</b> Este tutorial asume un conocimiento básico de R.
</div>
<p>El término <em>data wrangling</em> no tiene una traducción directa al español, pero hace referencia a un proceso que consiste en transformar datos crudos en otro formato que pueda ser usado para su análisis, y por esta razón, tener un objetivo de análisis es importante, ya que con base en ese objetivo se planifica la manipulación de la estructura, granularidad, precisión, etc. Generalmente, implica alguno(s) de los siguientes pasos:</p>
<ol type="1">
<li><strong>Descubrir</strong>: proceso de familiarización en el que se conceptualiza cómo podrían ser usados los datos, si existen variables incompletas, patrones reconocibles de errores, etc.</li>
<li><strong>Estructurar</strong>: transformar para que pueda ser aprovechado más fácilmente (por ejemplo, usando el formato <code>tidy</code> o <code>long-format</code>, que veremos más adelante).</li>
<li><strong>Limpiar</strong>: remover errores inherentes, que pueden surgir en varias formas. Por ejemplo, en bases de datos que han sido llenadas a mano por diferentes personas, una columna <code>Años</code> puede tener entradas que no sigan el mismo formato. Reducir los errores de tal forma que no influyan en los análisis.</li>
<li><strong>Enriquecer</strong>: una vez que se entiende un conjunto de datos y se ha transformado a un conjunto usable, se puede tomar la decisión de si enriquecerlo con un conjunto de datos adicional.</li>
<li><strong>Validar</strong>: verificar que el conjunto de datos es consistente y de calidad. Por ejemplo, si una columna en datos tabulares representa una variable, debe tener el mismo tipo de datos. Si una fila representa una observación, debe tener datos solo de esa observación, etc. Algunas reglas de consistencia son: tipo de datos (enteros, punto flotante, cadenas de caracteres), rango de datos (e.g., 0-100; por ejemplo, si una columna son Años, no puede tener valores negativos o mayores a 150), unicidad (e.g., códigos postales o un ID), consistencia de expresiones (e.g., usar solo una entre CP, C.P., Código Postal, CodPost, etc), valores nulos.</li>
</ol>
<section id="tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data"><code>tidy</code> data</h2>
<p>“A dataset is a collection of values, usually either numbers (if quantitative) or strings AKA text data (if qualitative). Values are organised in two ways. Every value belongs to a variable and an observation. A variable contains all values that measure the same underlying attribute (like height, temperature, duration) across units. An observation contains all values measured on the same unit (like a person, or a day, or a city) across attributes.” Wickham, 2014</p>
<p>El formato <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html#:~:text=Tidy%20data%20is%20a%20standard,Every%20row%20is%20an%20observation."><code>tidy</code></a> es un estándar de presentación que mapea el significado de un conjunto de datos a su estructura. Consiste básicamente en las siguientes tres reglas:</p>
<ol type="1">
<li>Cada columna es una variable.</li>
<li>Cada fila es una observación.</li>
<li>Cada celda es un valor único.</li>
</ol>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(IRdisplay)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>dir_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(), <span class="st">"/img/tidy-1.png"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">display_png</span>(<span class="at">file =</span> dir_name, <span class="at">width =</span> <span class="dv">480</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="data_wrangling_dplyr_files/figure-html/cell-2-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="dplyr" class="level2">
<h2 class="anchored" data-anchor-id="dplyr"><code>{dplyr}</code></h2>
<p><a href="https://dplyr.tidyverse.org/"><code>{dplyr}</code></a> es un paquete para la manipulación de datos que consiste en un conjunto de ‘verbos’ (o funciones) como:</p>
<ul>
<li><code>mutate()</code>: añade nuevas variables (columnas).</li>
<li><code>select()</code>: seleccionar columnas (variables) de un <code>data frame</code> <em>por su nombre</em> y retorna un <code>data frame</code> con solo las columnas seleccionadas.</li>
<li><code>filter()</code>: selecciona <em>casos</em> (filas) por su valor. Necesita una expresión lógica con la cual realizar la selección.</li>
<li><code>summarise()</code>: crea un nuevo <code>data frame</code> basado en combinaciones únicas de variables agrupadoras.</li>
<li><code>group_by()</code>: no realiza ninguna transformación, pero permite aplicar transformaciones por nivel de granularidad. Por ejemplo, en el análisis exploratorio es común dividir un conjunto de datos en cierto nivel de granularidad. Por ejemplo, si son series temporales, un nivel de granularidad es al año. Usaríamos una columna <code>year</code> para agrupar las variables, y en ese nivel de granularidad estimaríamos algunos estadísticos como la media y la desviación estándar. A esta estrategia de análisis se le conoce como <em>split-apply-combine</em>. Se ilustra en el siguiente gráfico.</li>
</ul>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dir_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(), <span class="st">"/img/split_apply_combine.png"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">display_png</span>(<span class="at">file =</span> dir_name, <span class="at">width =</span> <span class="dv">540</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">display_text</span>(<span class="st">"Estrategia split (separar por grupos), apply (aplicar una función por cada grupo),</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">combine (unir los grupos nuevamente). En el centro se muestran las funciones de dplyr que </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">usaríamos para cada paso de la estrategia. La función summarise retorna un valor único por grupo."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="data_wrangling_dplyr_files/figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>Estrategia split (separar por grupos), apply (aplicar una función por cada grupo),
combine (unir los grupos nuevamente). En el centro se muestran las funciones de dplyr que 
usaríamos para cada paso de la estrategia. La función summarise retorna un valor único por grupo.</code></pre>
</div>
</div>
<p>Otra función importante aunque ajena al paquete de <code>tidyverse</code> es el operador <em>pipe</em>, <code>%&gt;%</code>. Este operador permite pasar el resultado de una función a la izquierda como argumento de una función a la derecha. Por ejemplo</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mean_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Crea el vector con <code>c(1, 2, 3, 5)</code>, y este vector es pasado a la función <code>mean()</code>; es este el valor que es asignado a <code>mean_vec</code>. Es especialmente útil cuando la transformación sigue muchos pasos, como agrupar con <code>group_by</code>, seleccionar unas variables con <code>select</code>, crear nuevas variables con <code>mutate</code> y finalmente usar <code>summarise</code>.</p>
</section>
<section id="tidyr" class="level2">
<h2 class="anchored" data-anchor-id="tidyr"><code>{tidyr}</code></h2>
<p>Las funciones del paquete <a href="https://tidyr.tidyverse.org/"><code>{tidyr}</code></a> están en las siguientes categorías</p>
<ul>
<li>Pivotar: convertir datos entre formato largo y formato amplio. Se usan principalmente dos funciones
<ul>
<li><code>pivot_longer()</code>, que incrementa el número de filas y reduce el número de columnas.</li>
<li><code>pivot_wider()</code>, que hace lo contrario.</li>
</ul></li>
<li>Rectangular: que convierte listas de datos anidados (como en formato JSON) en tablas rectangulares.
<ul>
<li><code>unnest_longer()</code>: cambia cada elemento de una lista-columna en una fila.</li>
<li><code>unnest_wider()</code>: cambia cada elemento de una lista-columna en una columna.</li>
</ul></li>
</ul>
<p>Este gif muestra el funcionamiento de <code>pivot_*</code></p>
<p align="center">
<img src="img/tidyr-pivoting.gif" width="40%">
</p>
<p>A continuación veremos cómo usar diversas funciones de <code>{dplyr}</code> y <code>{tidyr}</code> para dejar nuestros datos en el estándar de <code>tidy data</code>.</p>
<p>Comenzamos instalando el metapaquete <code>{tidyverse}</code>, que contiene a los paquetes <code>{dplyr}</code> y <code>{tidyr}</code> (además de otros que usaremos en otros tutoriales).</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correr solo una vez si no se tiene instalado ya</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('tidyverse') # descomentar para instalar, puede tardar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejemplificar algunos usos, usaremos dos datasets que vienen junto con <code>{tidyverse}</code>: - <code>mpg</code>: es un conjunto de datos de economía de combustible entre 1999 y 2008 para 38 modelos de automóviles. Contiene 11 variables: - manufacturer, model, displ (cilindrada), year, cyl (número de cilindros), trans (transmisión mecánica o automática), drv (tracción, 4 tipos), cty (millas (urbanas) recorridas por galón), hwy (millas (en carretera) recorridas por galón), fl (tipo de combustible), class (tipo de coche). - <code>relig_income</code>: encuesta del Pew Research Center sobre la religión y el ingreso. Contiene las variables: - Religión (religión con la que se asocian) y 17 variables categóricas más sobre el ingreso (e.g., <code>&lt;$10k</code>, <code>$10-20k</code>, etc.).</p>
<section id="manipulación-usando-mpg-millas-por-galón" class="level3">
<h3 class="anchored" data-anchor-id="manipulación-usando-mpg-millas-por-galón">Manipulación usando <code>mpg</code> (millas por galón)</h3>
<p>Cargar la paquetería <code>tidyverse</code> e inspeccionar la estructura del conjunto de datos <code>mpg</code> usando la función <code>head()</code></p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar el paquete tidyverse</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tidyverse, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizar las primeras 6 filas por defecto</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mpg)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># para visualizar más filas, como segundo argumento se añade el número de filas</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># p. ej: head(mpg, 12)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 6 × 11</caption>
<thead>
    <tr><th scope="col">manufacturer</th><th scope="col">model</th><th scope="col">displ</th><th scope="col">year</th><th scope="col">cyl</th><th scope="col">trans</th><th scope="col">drv</th><th scope="col">cty</th><th scope="col">hwy</th><th scope="col">fl</th><th scope="col">class</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>auto(l5)  </td><td>f</td><td>18</td><td>29</td><td>p</td><td>compact</td></tr>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>manual(m5)</td><td>f</td><td>21</td><td>29</td><td>p</td><td>compact</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.0</td><td>2008</td><td>4</td><td>manual(m6)</td><td>f</td><td>20</td><td>31</td><td>p</td><td>compact</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.0</td><td>2008</td><td>4</td><td>auto(av)  </td><td>f</td><td>21</td><td>30</td><td>p</td><td>compact</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.8</td><td>1999</td><td>6</td><td>auto(l5)  </td><td>f</td><td>16</td><td>26</td><td>p</td><td>compact</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.8</td><td>1999</td><td>6</td><td>manual(m5)</td><td>f</td><td>18</td><td>26</td><td>p</td><td>compact</td></tr>
</tbody>
</table>
</div>
</div>
<p>Una alternativa a la función <code>head()</code> es usar <code>glimpse()</code>, del paquete <code>dplyr</code> (se instala y carga junto con <code>tidyverse</code>). <code>glimpse()</code> retorna una forma transpuesta de un <code>data.frame</code>, con las columnas como filas.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 234
Columns: 11
$ manufacturer &lt;chr&gt; "audi", "audi", "audi", "audi", "audi", "audi", "audi", "…
$ model        &lt;chr&gt; "a4", "a4", "a4", "a4", "a4", "a4", "a4", "a4 quattro", "…
$ displ        &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0, 2.0, 2.…
$ year         &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1999, 200…
$ cyl          &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, 8, 8, …
$ trans        &lt;chr&gt; "auto(l5)", "manual(m5)", "manual(m6)", "auto(av)", "auto…
$ drv          &lt;chr&gt; "f", "f", "f", "f", "f", "f", "f", "4", "4", "4", "4", "4…
$ cty          &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 17, 17, 1…
$ hwy          &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 25, 25, 2…
$ fl           &lt;chr&gt; "p", "p", "p", "p", "p", "p", "p", "p", "p", "p", "p", "p…
$ class        &lt;chr&gt; "compact", "compact", "compact", "compact", "compact", "c…</code></pre>
</div>
</div>
<p>Ahora crearemos una nueva variable en <code>mpg</code> usando <code>mutate()</code>. La nueva variable se declara dentro de <code>mutate()</code> con <code>=</code>. Notar el uso del operador pipe, <code>%&gt;%</code>: <code>mpg</code> pasa como primer argumento de <code>mutate()</code> (que, de acuerdo con la documentación, es <code>.data</code>, un <code>data frame</code> o el equivalente <code>tibble</code>), y las variables <code>cty</code>, <code>hwy</code> son indicadas solo por su nombres.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crear una nueva variable de millas por galón que sea el promedio de millas</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># en la ciudad y millas en carretera</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">avg_mpg =</span> (cty <span class="sc">+</span> hwy) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizar las primeras 6 filas</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mpg)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que la última fila avg_mpg no estaba antes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 6 × 12</caption>
<thead>
    <tr><th scope="col">manufacturer</th><th scope="col">model</th><th scope="col">displ</th><th scope="col">year</th><th scope="col">cyl</th><th scope="col">trans</th><th scope="col">drv</th><th scope="col">cty</th><th scope="col">hwy</th><th scope="col">fl</th><th scope="col">class</th><th scope="col">avg_mpg</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>auto(l5)  </td><td>f</td><td>18</td><td>29</td><td>p</td><td>compact</td><td>23.5</td></tr>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>manual(m5)</td><td>f</td><td>21</td><td>29</td><td>p</td><td>compact</td><td>25.0</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.0</td><td>2008</td><td>4</td><td>manual(m6)</td><td>f</td><td>20</td><td>31</td><td>p</td><td>compact</td><td>25.5</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.0</td><td>2008</td><td>4</td><td>auto(av)  </td><td>f</td><td>21</td><td>30</td><td>p</td><td>compact</td><td>25.5</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.8</td><td>1999</td><td>6</td><td>auto(l5)  </td><td>f</td><td>16</td><td>26</td><td>p</td><td>compact</td><td>21.0</td></tr>
    <tr><td>audi</td><td>a4</td><td>2.8</td><td>1999</td><td>6</td><td>manual(m5)</td><td>f</td><td>18</td><td>26</td><td>p</td><td>compact</td><td>22.0</td></tr>
</tbody>
</table>
</div>
</div>
<p>Para seleccionar una o más variables y que las retorne como <code>data.frame</code> o <code>tibble</code> usamos <code>select()</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(manufacturer, cyl) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># para mostrar solo las primeras 6 filas</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 6 × 2</caption>
<thead>
    <tr><th scope="col">manufacturer</th><th scope="col">cyl</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>audi</td><td>4</td></tr>
    <tr><td>audi</td><td>4</td></tr>
    <tr><td>audi</td><td>4</td></tr>
    <tr><td>audi</td><td>4</td></tr>
    <tr><td>audi</td><td>6</td></tr>
    <tr><td>audi</td><td>6</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seleccionar manufacturer, cyl y displ y asignarlas a un objeto llamado mcd</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mcd <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(manufacturer, cyl, displ)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mcd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 6 × 3</caption>
<thead>
    <tr><th scope="col">manufacturer</th><th scope="col">cyl</th><th scope="col">displ</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>audi</td><td>4</td><td>1.8</td></tr>
    <tr><td>audi</td><td>4</td><td>1.8</td></tr>
    <tr><td>audi</td><td>4</td><td>2.0</td></tr>
    <tr><td>audi</td><td>4</td><td>2.0</td></tr>
    <tr><td>audi</td><td>6</td><td>2.8</td></tr>
    <tr><td>audi</td><td>6</td><td>2.8</td></tr>
</tbody>
</table>
</div>
</div>
<p>Ahora haremos algo más complicado. Vamos a agrupar por <code>manufacturer</code> y a obtener el promedio de <code>avg_mpg</code> que creamos antes</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mpg_summary <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># crear la nueva variable</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_mpg =</span> (cty <span class="sc">+</span> hwy) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># agrupar por manufacturer</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(manufacturer) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># obtener el promedio de avg_mpg por manufacturer</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_mpg =</span> <span class="fu">mean</span>(avg_mpg))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># imprimir las primeras 6 filas</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mpg_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 6 × 2</caption>
<thead>
    <tr><th scope="col">manufacturer</th><th scope="col">mean_mpg</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>audi     </td><td>22.02778</td></tr>
    <tr><td>chevrolet</td><td>18.44737</td></tr>
    <tr><td>dodge    </td><td>15.54054</td></tr>
    <tr><td>ford     </td><td>16.68000</td></tr>
    <tr><td>honda    </td><td>28.50000</td></tr>
    <tr><td>hyundai  </td><td>22.75000</td></tr>
</tbody>
</table>
</div>
</div>
<p>Ejercicio:</p>
<ol type="1">
<li>Crear la variable <code>avg_mpg</code> nuevamente.</li>
<li>Agrupar por transmisión (<code>trans</code>).</li>
<li>Obtener: la suma de <code>avg_mpg</code>, la cantidad de datos (usando <code>count = n()</code>), la media y la desviación estándar.</li>
</ol>
</section>
<section id="manipulación-usandp-relig_income" class="level3">
<h3 class="anchored" data-anchor-id="manipulación-usandp-relig_income">Manipulación usandp <code>relig_income</code></h3>
<p>Se carga junto con <code>tidyverse</code>. Primero exploramos su estructura</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imprimir en consola y observar estructura de relig_income</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(relig_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 6 × 11</caption>
<thead>
    <tr><th scope="col">religion</th><th scope="col">&lt;$10k</th><th scope="col">$10-20k</th><th scope="col">$20-30k</th><th scope="col">$30-40k</th><th scope="col">$40-50k</th><th scope="col">$50-75k</th><th scope="col">$75-100k</th><th scope="col">$100-150k</th><th scope="col">&gt;150k</th><th scope="col">Don't know/refused</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>Agnostic          </td><td> 27</td><td> 34</td><td>  60</td><td> 81</td><td> 76</td><td> 137</td><td>122</td><td>109</td><td> 84</td><td>  96</td></tr>
    <tr><td>Atheist           </td><td> 12</td><td> 27</td><td>  37</td><td> 52</td><td> 35</td><td>  70</td><td> 73</td><td> 59</td><td> 74</td><td>  76</td></tr>
    <tr><td>Buddhist          </td><td> 27</td><td> 21</td><td>  30</td><td> 34</td><td> 33</td><td>  58</td><td> 62</td><td> 39</td><td> 53</td><td>  54</td></tr>
    <tr><td>Catholic          </td><td>418</td><td>617</td><td> 732</td><td>670</td><td>638</td><td>1116</td><td>949</td><td>792</td><td>633</td><td>1489</td></tr>
    <tr><td>Don’t know/refused</td><td> 15</td><td> 14</td><td>  15</td><td> 11</td><td> 10</td><td>  35</td><td> 21</td><td> 17</td><td> 18</td><td> 116</td></tr>
    <tr><td>Evangelical Prot  </td><td>575</td><td>869</td><td>1064</td><td>982</td><td>881</td><td>1486</td><td>949</td><td>723</td><td>414</td><td>1529</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(relig_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 18
Columns: 11
$ religion             &lt;chr&gt; "Agnostic", "Atheist", "Buddhist", "Catholic", "D…
$ `&lt;$10k`              &lt;dbl&gt; 27, 12, 27, 418, 15, 575, 1, 228, 20, 19, 289, 29…
$ `$10-20k`            &lt;dbl&gt; 34, 27, 21, 617, 14, 869, 9, 244, 27, 19, 495, 40…
$ `$20-30k`            &lt;dbl&gt; 60, 37, 30, 732, 15, 1064, 7, 236, 24, 25, 619, 4…
$ `$30-40k`            &lt;dbl&gt; 81, 52, 34, 670, 11, 982, 9, 238, 24, 25, 655, 51…
$ `$40-50k`            &lt;dbl&gt; 76, 35, 33, 638, 10, 881, 11, 197, 21, 30, 651, 5…
$ `$50-75k`            &lt;dbl&gt; 137, 70, 58, 1116, 35, 1486, 34, 223, 30, 95, 110…
$ `$75-100k`           &lt;dbl&gt; 122, 73, 62, 949, 21, 949, 47, 131, 15, 69, 939, …
$ `$100-150k`          &lt;dbl&gt; 109, 59, 39, 792, 17, 723, 48, 81, 11, 87, 753, 4…
$ `&gt;150k`              &lt;dbl&gt; 84, 74, 53, 633, 18, 414, 54, 78, 6, 151, 634, 42…
$ `Don't know/refused` &lt;dbl&gt; 96, 76, 54, 1489, 116, 1529, 37, 339, 37, 162, 13…</code></pre>
</div>
</div>
<p>Los nombres de las columnas no definen variables. De hecho, <em>todos los nombres pertenecen a una variable</em> (ingreso). Debemos transformar el conjunto de datos de <code>wide</code> (con más columnas) a <code>long</code> (con menos columnas, más filas) para eso, usamos <code>pivot_longer()</code> del paquete <code>tidyr</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>relig_income <span class="sc">%&gt;%</span> <span class="co"># función 'pipe'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tomar todas las columnas, excepto religion; se indica con -religion</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>religion,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># crea variable (tipo character) 'income' con los nombres de columnas</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"income"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># crea var 'freq' (tipo numérico) con los valores de las columnas</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"freq"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 180
Columns: 3
$ religion &lt;chr&gt; "Agnostic", "Agnostic", "Agnostic", "Agnostic", "Agnostic", "…
$ income   &lt;chr&gt; "&lt;$10k", "$10-20k", "$20-30k", "$30-40k", "$40-50k", "$50-75k…
$ freq     &lt;dbl&gt; 27, 34, 60, 81, 76, 137, 122, 109, 84, 96, 12, 27, 37, 52, 35…</code></pre>
</div>
</div>
<p>Notar que la nueva variable creada <code>income</code> es categórica, y sus valores (o niveles) son los nombres de las columnas 2 a 11 del conjunto original.</p>
<p>Usando <code>glimpse()</code> podemos verificar que <code>pivot_longer()</code> redujo el número de columnas a 3 (originalmente 11), e incrementó el número de filas a 180 (originalmente de 18).</p>
<p>Para poder usar después la transformación en formato <code>tidy</code> lo asignamos a un nuevo objeto (o bien, podemos asignarlo al objeto con el mismo nombre, para ahorrar memoria).</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># asignar a relig_income_tidy</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>relig_income_tidy <span class="ot">&lt;-</span> relig_income <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>religion,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">'income'</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">'freq'</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(relig_income_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 180
Columns: 3
$ religion &lt;chr&gt; "Agnostic", "Agnostic", "Agnostic", "Agnostic", "Agnostic", "…
$ income   &lt;chr&gt; "&lt;$10k", "$10-20k", "$20-30k", "$30-40k", "$40-50k", "$50-75k…
$ freq     &lt;dbl&gt; 27, 34, 60, 81, 76, 137, 122, 109, 84, 96, 12, 27, 37, 52, 35…</code></pre>
</div>
</div>
<p>Si queremos filtrar por casos, podemos usar la función <code>filter</code>. Como se digo al principio, esta función filtra por filas cuando se cumple una condición lógica. Por ejemplo, si solo queremos las filas que sean número par lo logramos usando el operador módulo <code>%%</code>. Cuando el número de fila es par, el residuo del número de fila entre dos debería ser 0, que se traduce en <code>num_fila %% 2 == 0</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>relig_income_tidy <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># agregar el número de fila con mutate para verificar que excluimos los nones</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_fila =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># equivalentemente, podríamos usar la columna recién creada num_fila %% 2 == 0</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 90
Columns: 4
$ religion &lt;chr&gt; "Agnostic", "Agnostic", "Agnostic", "Agnostic", "Agnostic", "…
$ income   &lt;chr&gt; "$10-20k", "$30-40k", "$50-75k", "$100-150k", "Don't know/ref…
$ freq     &lt;dbl&gt; 34, 81, 137, 109, 96, 27, 52, 70, 59, 76, 21, 34, 58, 39, 54,…
$ num_fila &lt;int&gt; 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 3…</code></pre>
</div>
</div>
<p>Notar que la cantidad de filas se redujo a la mitad, y que <code>num_fila</code> solo tiene números pares.</p>
<p>Ejercicio:</p>
<ol type="1">
<li>Agrupar por religion y obtener la suma, la media, y la cantidad de datos o filas (usando <code>n()</code>) de salario (<code>freq</code>) por religión.</li>
<li>Excluir la religión <code>Unaffiliated</code> y <code>Don’t know/refused</code> (usando <code>filter(religion != Unaffiliated)</code>), y repetir el paso 1.</li>
<li>Filtrar solo los casos en donde la religión es <code>Agnostic</code> o <code>Atheist</code> y repetir el paso 1.</li>
</ol>
</section>
</section>
<section id="valores-perdidos-explícitos-e-implícitos" class="level2">
<h2 class="anchored" data-anchor-id="valores-perdidos-explícitos-e-implícitos">Valores perdidos explícitos e implícitos</h2>
<p>Los valores perdidos <em>explícitos</em> son valores en donde aparece un <code>NA</code> para una combinación de filas y columnas.</p>
<p>Los valores perdidos <em>implícitos</em> es la ausencia de un valor que debería estar.</p>
<p>Una forma en la que los perdidos explícitos sucede de forma natural es cuando un valor de una celda se repite y, por lo tanto, se omite. Al cargarlo en R, por defecto se llena con <code>NA</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>person,           <span class="sc">~</span>treatment, <span class="sc">~</span>response,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Derrick Whitmore"</span>, <span class="dv">1</span>,         <span class="dv">7</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>,                 <span class="dv">2</span>,         <span class="dv">10</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>,                 <span class="dv">3</span>,         <span class="cn">NA</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Katherine Burke"</span>,  <span class="dv">1</span>,         <span class="dv">4</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>treatment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 4 × 3</caption>
<thead>
    <tr><th scope="col">person</th><th scope="col">treatment</th><th scope="col">response</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>Derrick Whitmore</td><td>1</td><td> 7</td></tr>
    <tr><td>NA              </td><td>2</td><td>10</td></tr>
    <tr><td>NA              </td><td>3</td><td>NA</td></tr>
    <tr><td>Katherine Burke </td><td>1</td><td> 4</td></tr>
</tbody>
</table>
</div>
</div>
<p>Si es el caso, esos valores se pueden rellenar con el último dato completo, una técnica que se llama, en inglés, <em>last observation carried forward</em> (LOCF).</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>treatment <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(person)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 4 × 3</caption>
<thead>
    <tr><th scope="col">person</th><th scope="col">treatment</th><th scope="col">response</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>Derrick Whitmore</td><td>1</td><td> 7</td></tr>
    <tr><td>Derrick Whitmore</td><td>2</td><td>10</td></tr>
    <tr><td>Derrick Whitmore</td><td>3</td><td>NA</td></tr>
    <tr><td>Katherine Burke </td><td>1</td><td> 4</td></tr>
</tbody>
</table>
</div>
</div>
<p>Si queremos hacer lo mismo en todas las columnas (asumiendo que un dato repetido no se escriba en esas variables), usamos <code>everything()</code>, del paquete <code>tidyselect</code> (se carga junto con <code>tidyverse</code>). Esta función, de acuerdo a la documentación, selecciona todas las variables.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>treatment <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(<span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 4 × 3</caption>
<thead>
    <tr><th scope="col">person</th><th scope="col">treatment</th><th scope="col">response</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>Derrick Whitmore</td><td>1</td><td> 7</td></tr>
    <tr><td>Derrick Whitmore</td><td>2</td><td>10</td></tr>
    <tr><td>Derrick Whitmore</td><td>3</td><td>10</td></tr>
    <tr><td>Katherine Burke </td><td>1</td><td> 4</td></tr>
</tbody>
</table>
</div>
</div>
<p>Veamos ahora faltantes implícitos.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>stocks <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year  =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2021</span>, <span class="dv">2021</span>),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">qtr   =</span> <span class="fu">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.35</span>,   <span class="cn">NA</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>, <span class="fl">2.66</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>stocks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 7 × 3</caption>
<thead>
    <tr><th scope="col">year</th><th scope="col">qtr</th><th scope="col">price</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2020</td><td>1</td><td>1.88</td></tr>
    <tr><td>2020</td><td>2</td><td>0.59</td></tr>
    <tr><td>2020</td><td>3</td><td>0.35</td></tr>
    <tr><td>2020</td><td>4</td><td>  NA</td></tr>
    <tr><td>2021</td><td>2</td><td>0.92</td></tr>
    <tr><td>2021</td><td>3</td><td>0.17</td></tr>
    <tr><td>2021</td><td>4</td><td>2.66</td></tr>
</tbody>
</table>
</div>
</div>
<p>En este conjunto de datos, la variable <code>price</code> tiene un faltante explícito (<code>NA</code> en el cuarto trimestre del 2020), pero también tiene un faltante implícito en el primer trimestre del 2021. Usando <code>pivot_wider</code> (que cambia de <code>long</code> a <code>wider</code>) se puede hacer explícito, porque cada <em>combinación de variables y unidades de observación (columnas y filas) debe tener un valor</em>, por lo que la celda <code>[2021, 1]</code> se rellena con <code>NA</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>stocks <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> qtr,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> price</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 2 × 5</caption>
<thead>
    <tr><th scope="col">year</th><th scope="col">1</th><th scope="col">2</th><th scope="col">3</th><th scope="col">4</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2020</td><td>1.88</td><td>0.59</td><td>0.35</td><td>  NA</td></tr>
    <tr><td>2021</td><td>  NA</td><td>0.92</td><td>0.17</td><td>2.66</td></tr>
</tbody>
</table>
</div>
</div>
<p>Por otro lado, si conocemos el valor que debería tener un faltante, podemos reemplazar el <code>NA</code> un valor explícito usando la función <code>complete()</code>. Los argumentos de esta función son <code>.data</code> (que pasamos con <code>%&gt;%</code>) y las columnas que se quieren expandir por combinaciones únicas de valores.</p>
<p>En este caso, queremos un valor de <code>price</code> por cada combinación única de <code>year</code> y <code>qtr</code> (trimestre). El tercer argumento es <code>fill</code>, que espera una lista con nombres de las columnas a ser expandidas y los valores que debe sustituir en vez de <code>NA</code>, pero ojo: si el cuarto argumento, <code>explicit</code>, se deja por defecto (<code>TRUE</code>) se reemplazan tanto los faltantes explícitos como implícitos. Cambiar <code>explicit</code> a <code>FALSE</code> provoca que <em>solo</em> los implícitos sean reemplazados por el valor indicado en <code>fill</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>stocks <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, qtr, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">price =</span> <span class="dv">0</span>), <span class="at">explicit =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 8 × 3</caption>
<thead>
    <tr><th scope="col">year</th><th scope="col">qtr</th><th scope="col">price</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2020</td><td>1</td><td>1.88</td></tr>
    <tr><td>2020</td><td>2</td><td>0.59</td></tr>
    <tr><td>2020</td><td>3</td><td>0.35</td></tr>
    <tr><td>2020</td><td>4</td><td>  NA</td></tr>
    <tr><td>2021</td><td>1</td><td>0.00</td></tr>
    <tr><td>2021</td><td>2</td><td>0.92</td></tr>
    <tr><td>2021</td><td>3</td><td>0.17</td></tr>
    <tr><td>2021</td><td>4</td><td>2.66</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivotar de nuevo</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>stocks <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, qtr, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">price =</span> <span class="dv">0</span>), <span class="at">explicit =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> qtr,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> price</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 2 × 5</caption>
<thead>
    <tr><th scope="col">year</th><th scope="col">1</th><th scope="col">2</th><th scope="col">3</th><th scope="col">4</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2020</td><td>1.88</td><td>0.59</td><td>0.35</td><td>  NA</td></tr>
    <tr><td>2021</td><td>0.00</td><td>0.92</td><td>0.17</td><td>2.66</td></tr>
</tbody>
</table>
</div>
</div>
<p>Notar que ahora la combinación <code>year = 2021</code> y <code>qtr=1</code> tiene como valor 0.00.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>